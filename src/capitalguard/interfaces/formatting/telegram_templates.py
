# -*- coding: utf-8 -*-
from __future__ import annotations
from typing import List, Optional

def format_signal(
    rec_id: int,
    symbol: str,
    side: str,
    entry: float,
    sl: float,
    targets: List[float],
    notes: Optional[str] = None,
) -> str:
    def tp_pct(t: float) -> str:
        try:
            if side.upper() == "LONG":
                pct = ((t - entry) / entry) * 100
            else:
                pct = ((entry - t) / entry) * 100
            return f"{pct:+.2f}%"
        except Exception:
            return "-"

    targets_with_pct = " â€¢ ".join([f"{t:g} ({tp_pct(t)})" for t in targets])

    lines = []
    lines.append("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
    lines.append(f"â”‚ ğŸ“£ Trade Signal â€” #REC{rec_id:04d} â”‚  #{symbol} #Futures #{side.capitalize()}")
    lines.append("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
    lines.append(f"ğŸ’ Symbol : {symbol}")
    lines.append(f"ğŸ“Œ Type   : Futures / {side.upper()}")
    lines.append("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")
    lines.append(f"ğŸ’° Entry  : {entry:g}")
    lines.append(f"ğŸ›‘ SL     : {sl:g}")
    lines.append("")
    lines.append(f"ğŸ¯ TPs   : {targets_with_pct}")
    lines.append("")
    lines.append("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")
    lines.append("ğŸ“Š R/R   : -")
    if notes:
        lines.append(f"ğŸ“ Notes : {notes}")
        lines.append("")
    lines.append("(Disclaimer: Not financial advice. Manage your risk.)")
    return "\n".join(lines)

def format_closed(rec_id: int, symbol: str, exit_price: float) -> str:
    return f"âœ… Closed â€” #REC{rec_id:04d}\nâ€¢ {symbol} @ {exit_price:g}"

def format_report(total: int, open_cnt: int, closed_cnt: int, top_asset: str | None) -> str:
    return (
        "ğŸ“ˆ ØªÙ‚Ø±ÙŠØ± Ù…Ø®ØªØµØ±\n"
        f"â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙˆØµÙŠØ§Øª: {total}\n"
        f"â€¢ Ø§Ù„Ù…ÙØªÙˆØ­Ø©: {open_cnt} | Ø§Ù„Ù…ØºÙ„Ù‚Ø©: {closed_cnt}\n"
        f"â€¢ Ø£ÙƒØ«Ø± Ø£ØµÙ„ ØªÙƒØ±Ø§Ø±Ù‹Ø§: {top_asset or '-'}"
    )