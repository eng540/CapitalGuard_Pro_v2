# تقرير تحليلي وخطة عمل - CapitalGuard Pro v2

## جدول المحتويات
1.  [ملخص تنفيذي](#ملخص-تنفيذي)
2.  [شجرة المجلدات](#شجرة-المجلدات)
3.  [تحليل النظام](#تحليل-النظام)
4.  [تحليل الملفات الرئيسية](#تحليل-الملفات-الرئيسية)
5.  [تحليل معمق للشيفرة البرمجية](#تحليل-معمق-للشيفرة-البرمجية)
6.  [تحليل التبعيات](#تحليل-التبعيات)
7.  [خطة العمل](#خطة-العمل)
8.  [خطة النشر للإنتاج](#خطة-النشر-للإنتاج)
9.  [خطة الاختبار](#خطة-الاختبار)

## ملخص تنفيذي
(تم الإبقاء عليه كما هو)

... (الأقسام 2-7 تم الإبقاء عليها كما هي) ...

## 8. خطة النشر للإنتاج

### 8.1. البيئة (Environment)
*   **Staging**: يجب إعداد بيئة مطابقة لبيئة الإنتاج لاختبار التغييرات قبل نشرها.
*   **الإنتاج (Production)**: استخدام Docker Compose للنشر. يجب إدارة جميع الأسرار (secrets) عبر متغيرات البيئة.

### 8.2. عملية النشر (Deployment Process)
1.  **دمج التغييرات**: دمج فرع الميزة في الفرع الرئيسي بعد مراجعة الشيفرة البرمجية واجتياز اختبارات CI.
2.  **إنشاء إصدار**: إنشاء علامة Git للإصدار الجديد.
3.  **النشر إلى Staging**: نشر الإصدار الجديد تلقائيًا إلى بيئة Staging.
4.  **الاختبار في Staging**: إجراء اختبارات قبول المستخدم (UAT) واختبارات دخان (smoke tests).
5.  **النشر إلى الإنتاج**: يوصى بالنشر التدريجي (canary release).
6.  **التحقق بعد النشر**: مراقبة السجلات والمقاييس للتأكد من استقرار النظام.

### 8.3. النسخ الاحتياطي والعودة إلى إصدار سابق
*   **النسخ الاحتياطي**: إجراء نسخ احتياطي منتظم لقاعدة بيانات PostgreSQL.
*   **العودة إلى إصدار سابق**: خطة واضحة للعودة إلى الإصدار السابق عن طريق إعادة نشر صورة Docker المستقرة السابقة.

## 9. خطة الاختبار

### 9.1. أنواع الاختبارات
| النوع | الهدف | مثال حالة اختبار |
| :--- | :--- | :--- |
| **اختبارات الوحدة** | اختبار أصغر أجزاء الشيفرة البرمجية بشكل منعزل. | التحقق من صحة حساب PnL في `trade_service.py` لصفقة شراء (LONG). |
| **اختبارات التكامل** | اختبار تفاعل المكونات المختلفة معًا. | اختبار تدفق إنشاء توصية، تفعيلها، ثم إغلاقها، والتحقق من حالتها في قاعدة البيانات. |
| **اختبارات الأداء** | قياس أداء النظام تحت الحمل. | محاكاة 10,000 تداول نشط و 1,000 تحديث سعر في الثانية لاختبار استجابة `AlertService`. |
| **اختبارات الأمان** | تحديد وإصلاح الثغرات الأمنية. | إرسال "JWT bomb" إلى نقطة نهاية محمية والتحقق من أن الخدمة لا تتعطل. |

### 9.2. أتمتة الاختبارات (CI/CD)
*   **الأداة**: GitHub Actions.
*   **العملية**: يجب أن يتم تشغيل جميع اختبارات الوحدة والتكامل تلقائيًا عند كل `push` إلى أي فرع. يجب أن تتضمن عملية النشر إلى Staging تشغيل اختبارات الأداء والأمان.
*   **أمر التشغيل**: `make full-test`
