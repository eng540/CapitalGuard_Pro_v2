#--- START OF FILE: docker-compose.yml ---
version: "3.9"  
services:  
  db:  
    image: postgres:16  
    environment:  
      POSTGRES_DB: capitalguard  
      POSTGRES_USER: cg  
      POSTGRES_PASSWORD: cgpass  
    ports:  
      - "5432:5432"  
    volumes:  
      - pgdata:/var/lib/postgresql/data  

  api:  
    # ✅ FIX: Explicitly set the target platform for the build.
    # This ensures the image is compatible with the production server (e.g., Railway).
    platform: linux/amd64
    build:  
      context: .  
      dockerfile: Dockerfile
    environment:  
      DATABASE_URL: postgresql+psycopg://cg:cgpass@db:5432/capitalguard  
      API_KEY: ${API_KEY}
      # ... (أضف باقي متغيرات البيئة الخاصة بك هنا من ملف .env)
    ports:  
      - "8000:8000"  
    depends_on: ["db"]  

  watcher:  
    # ✅ FIX: Also set the platform here for consistency.
    platform: linux/amd64
    build:  
      context: .  
      dockerfile: Dockerfile.watcher  
    environment:  
      DATABASE_URL: postgresql+psycopg://cg:cgpass@db:5432/capitalguard
      # ... (أضف باقي متغيرات البيئة الخاصة بك هنا)
    depends_on: ["db"]  

volumes:  
  pgdata:
#--- END OF FILE ---